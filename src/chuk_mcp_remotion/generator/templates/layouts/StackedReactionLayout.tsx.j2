import React from 'react';
import { AbsoluteFill, useCurrentFrame } from 'remotion';

interface StackedReactionLayoutProps {
  originalClip?: React.ReactNode;
  reactorFace?: React.ReactNode;
  startFrame: number;
  durationInFrames: number;
}

/**
 * StackedReactionLayout - Vertical stack for reaction videos
 *
 * Perfect for:
 * - Music/video reactions
 * - Commentary content
 * - YouTube Shorts and TikTok reactions
 * - Reacting to clips and memes
 *
 * Config options:
 * - clip_ratio: Height percentage for original clip (default: 65)
 * - gap: Space between panels
 * - show_labels: Show "ORIGINAL" and "REACTION" badges (default: true)
 * - border_width, border_color: Styling
 */
export const StackedReactionLayout: React.FC<StackedReactionLayoutProps> = ({
  originalClip,
  reactorFace,
  startFrame,
  durationInFrames
}) => {
  const frame = useCurrentFrame();

  if (frame < startFrame || frame >= startFrame + durationInFrames) {
    return null;
  }

  const clipRatio = [[ config.clip_ratio or 65 ]];
  const reactorRatio = 100 - clipRatio;
  const gap = [[ config.gap or 20 ]];
  const showLabels = [[ 'true' if (config.show_labels if config.show_labels is defined else true) else 'false' ]];

  return (
    <AbsoluteFill style={{ pointerEvents: 'none' }}>
      <div
        style={{
          position: 'absolute',
          [% if config.padding %]
          top: [[ config.padding ]],
          left: [[ config.padding ]],
          right: [[ config.padding ]],
          bottom: [[ config.padding ]],
          [% else %]
          top: 40,
          left: 40,
          right: 40,
          bottom: 40,
          [% endif %]
          display: 'flex',
          flexDirection: 'column',
          gap,
        }}
      >
        {/* Original clip being reacted to */}
        <div
          style={{
            flex: `0 0 ${clipRatio}%`,
            [% if config.border_width %]
            border: '[[ config.border_width or 2 ]]px solid [[ config.border_color or colors.text.muted ]]',
            [% endif %]
            borderRadius: [[ config.border_radius or 8 ]],
            overflow: 'hidden',
            position: 'relative',
          }}
        >
          {originalClip}
          {showLabels && (
            <div
              style={{
                position: 'absolute',
                top: 12,
                right: 12,
                background: '[[ config.label_background or colors.background.glass ]]',
                backdropFilter: 'blur(10px)',
                padding: '4px 12px',
                borderRadius: 4,
                border: '1px solid [[ colors.accent[0] ]]4D',
                fontSize: 12,
                fontWeight: 600,
                color: '[[ colors.accent[0] ]]',
                fontFamily: '[[ 'system-ui, sans-serif' ]]',
                textTransform: 'uppercase',
                letterSpacing: '0.05em',
              }}
            >
              ORIGINAL
            </div>
          )}
        </div>

        {/* Reactor's face */}
        <div
          style={{
            flex: `0 0 ${reactorRatio}%`,
            border: '[[  config.reactor_border_width or 2 ]]px solid [[ config.reactor_border_color or colors.primary[0] ]]',
            borderRadius: [[ config.border_radius or 8 ]],
            overflow: 'hidden',
            position: 'relative',
          }}
        >
          {reactorFace}
          {showLabels && (
            <div
              style={{
                position: 'absolute',
                top: 12,
                right: 12,
                background: '[[ config.label_background or colors.background.glass ]]',
                backdropFilter: 'blur(10px)',
                padding: '4px 12px',
                borderRadius: 4,
                border: '1px solid [[ colors.primary[0] ]]4D',
                fontSize: 12,
                fontWeight: 600,
                color: '[[ colors.primary[0] ]]',
                fontFamily: '[[ 'system-ui, sans-serif' ]]',
                textTransform: 'uppercase',
                letterSpacing: '0.05em',
              }}
            >
              REACTION
            </div>
          )}
        </div>
      </div>
    </AbsoluteFill>
  );
};

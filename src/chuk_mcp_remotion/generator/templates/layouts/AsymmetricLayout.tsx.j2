import React from 'react';
import { AbsoluteFill, useCurrentFrame } from 'remotion';

interface AsymmetricLayoutProps {
  mainFeed?: React.ReactNode;
  demo1?: React.ReactNode;
  demo2?: React.ReactNode;
  overlay?: React.ReactNode;
  startFrame: number;
  durationInFrames: number;
}

/**
 * AsymmetricLayout - Perfect for YouTube tutorials
 *
 * Layouts available via config.layout:
 * - "main-right" (default): Demo panels on left (stacked), main feed on right (2/3 width)
 * - "main-left": Main feed on left (2/3 width), demo panels on right (stacked)
 * - "main-bottom": Demo panels on top (side by side), main feed on bottom (2/3 height)
 * - "main-top": Main feed on top (2/3 height), demo panels on bottom (side by side)
 */
export const AsymmetricLayout: React.FC<AsymmetricLayoutProps> = ({
  mainFeed,
  demo1,
  demo2,
  overlay,
  startFrame,
  durationInFrames
}) => {
  const frame = useCurrentFrame();
  const relativeFrame = frame - startFrame;

  // Don't render if outside the time range
  if (frame < startFrame || frame >= startFrame + durationInFrames) {
    return null;
  }

  const layout = '[[ config.layout or "main-right" ]]';
  const mainRatio = [[ config.main_ratio or 66.67 ]]; // Main feed takes 2/3 by default
  const demoRatio = 100 - mainRatio;

  const renderMainRight = () => (
    <div
      style={{
        position: 'absolute',
        [% if config.padding %]
        top: [[ config.padding ]],
        left: [[ config.padding ]],
        right: [[ config.padding ]],
        bottom: [[ config.padding ]],
        [% else %]
        top: 40,
        left: 40,
        right: 40,
        bottom: 40,
        [% endif %]
        display: 'flex',
        flexDirection: 'row',
        gap: [[ config.gap or 20 ]],
      }}
    >
      {/* Demo panels (left side, stacked) */}
      <div
        style={{
          flex: `0 0 calc(${demoRatio}% - [[ (config.gap or 20) / 2 ]]px)`,
          display: 'flex',
          flexDirection: 'column',
          gap: [[ config.gap or 20 ]],
        }}
      >
        <div
          style={{
            flex: '1 1 50%',
            [% if config.border_width %]
            border: '[[ config.border_width or 2 ]]px solid [[ config.border_color or colors.text.muted ]]',
            borderRadius: [[ config.border_radius or 8 ]],
            [% endif %]
            overflow: 'hidden',
            position: 'relative',
            [% if config.demo_background %]
            background: '[[ config.demo_background ]]',
            [% endif %]
          }}
        >
          {demo1}
        </div>
        <div
          style={{
            flex: '1 1 50%',
            [% if config.border_width %]
            border: '[[ config.border_width or 2 ]]px solid [[ config.border_color or colors.text.muted ]]',
            borderRadius: [[ config.border_radius or 8 ]],
            [% endif %]
            overflow: 'hidden',
            position: 'relative',
            [% if config.demo_background %]
            background: '[[ config.demo_background ]]',
            [% endif %]
          }}
        >
          {demo2}
        </div>
      </div>

      {/* Main feed (right side) */}
      <div
        style={{
          flex: `0 0 calc(${mainRatio}% - [[ (config.gap or 20) / 2 ]]px)`,
          [% if config.border_width %]
          border: '[[ config.border_width or 2 ]]px solid [[ config.border_color or "rgba(255, 255, 255, 0.2)" ]]',
          borderRadius: [[ config.border_radius or 8 ]],
          [% endif %]
          overflow: 'hidden',
          position: 'relative',
          [% if config.main_background %]
          background: '[[ config.main_background ]]',
          [% endif %]
        }}
      >
        {mainFeed}
      </div>
    </div>
  );

  const renderMainLeft = () => (
    <div
      style={{
        position: 'absolute',
        [% if config.padding %]
        top: [[ config.padding ]],
        left: [[ config.padding ]],
        right: [[ config.padding ]],
        bottom: [[ config.padding ]],
        [% else %]
        top: 40,
        left: 40,
        right: 40,
        bottom: 40,
        [% endif %]
        display: 'flex',
        flexDirection: 'row',
        gap: [[ config.gap or 20 ]],
      }}
    >
      {/* Main feed (left side) */}
      <div
        style={{
          flex: `0 0 calc(${mainRatio}% - [[ (config.gap or 20) / 2 ]]px)`,
          [% if config.border_width %]
          border: '[[ config.border_width or 2 ]]px solid [[ config.border_color or "rgba(255, 255, 255, 0.2)" ]]',
          borderRadius: [[ config.border_radius or 8 ]],
          [% endif %]
          overflow: 'hidden',
          position: 'relative',
          [% if config.main_background %]
          background: '[[ config.main_background ]]',
          [% endif %]
        }}
      >
        {mainFeed}
      </div>

      {/* Demo panels (right side, stacked) */}
      <div
        style={{
          flex: `0 0 calc(${demoRatio}% - [[ (config.gap or 20) / 2 ]]px)`,
          display: 'flex',
          flexDirection: 'column',
          gap: [[ config.gap or 20 ]],
        }}
      >
        <div
          style={{
            flex: '1 1 50%',
            [% if config.border_width %]
            border: '[[ config.border_width or 2 ]]px solid [[ config.border_color or colors.text.muted ]]',
            borderRadius: [[ config.border_radius or 8 ]],
            [% endif %]
            overflow: 'hidden',
            position: 'relative',
            [% if config.demo_background %]
            background: '[[ config.demo_background ]]',
            [% endif %]
          }}
        >
          {demo1}
        </div>
        <div
          style={{
            flex: '1 1 50%',
            [% if config.border_width %]
            border: '[[ config.border_width or 2 ]]px solid [[ config.border_color or colors.text.muted ]]',
            borderRadius: [[ config.border_radius or 8 ]],
            [% endif %]
            overflow: 'hidden',
            position: 'relative',
            [% if config.demo_background %]
            background: '[[ config.demo_background ]]',
            [% endif %]
          }}
        >
          {demo2}
        </div>
      </div>
    </div>
  );

  return (
    <AbsoluteFill style={{ pointerEvents: 'none' }}>
      {layout === 'main-left' ? renderMainLeft() : renderMainRight()}

      {/* Optional overlay (like lower third) */}
      {overlay && (
        <div style={{ position: 'absolute', bottom: 0, left: 0, right: 0 }}>
          {overlay}
        </div>
      )}
    </AbsoluteFill>
  );
};
